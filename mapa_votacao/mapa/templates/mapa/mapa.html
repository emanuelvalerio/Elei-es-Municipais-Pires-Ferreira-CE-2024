<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Votação</title>
    <style>

        /* Estilo do spinner */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border-left-color: #007bff;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #mapa {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .year-selector {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .year-option {
            padding: 5px 15px;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
        }

        .year-option:hover {
            background-color: #007bff;
            color: white;
        }

        .year-option.active {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            border-color: #007bff;
        }

        .menu-container {
            position: absolute;
            top: 135px; /* Distância suficiente abaixo do menu de anos */
            left: 50%;
            transform: translateX(-50%);
            z-index: 15; /* Menor que o menu de anos */
            display: none; /* Inicialmente escondido */
            gap: 80px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

        .candidate {
            text-align: center;
            cursor: pointer;
        }

        .candidate img {
            width: auto;
            height: auto;
            max-width: 80px;
            aspect-ratio: 1 / 1;
            border-radius: 50%;
            border: 5px solid transparent;
            object-position: top;
            object-fit: cover;
            transition: transform 0.5s ease-in-out, box-shadow 0.5s ease-in-out, border-color 0.3s ease-in-out;
        }

        .candidate img.active {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .candidate p {
            font-weight: bold;
            margin-top: 8px;
            color: black;
        }

        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            background-color: #f8f9fa;
            color: #333;
            padding: 10px 0;
            font-size: 14px;
            border-top: 1px solid #ddd;
            z-index: 20; /* Garante que o rodapé fique acima do conteúdo */
}


        footer p {
            margin: 0;
            font-family: Arial, sans-serif;
        }

       /* Estilo da barra de carregamento */
.loading-bar-container {
    position: relative;
    width: 80%;
    height: 10px;
    border-radius: 5px;
    background: #fff;
    margin-top: 15px;
}

.loading-bar {
    width: 100%;
    height: 100%;
    background: #007bff;
    animation: load 1s ease-in-out infinite;
}

@keyframes load {
    0% { width: 0; }
    25% { width: 25%; }
    50% { width: 50%; }
    75% { width: 75%; }
    100% { width: 100%; }
}
s
    </style>
</head>
<body>



        <!-- Spinner e barra de carregamento -->
        <div id="loading" style="display: none;">
            <div class="loading-bar-container">
                <div class="loading-bar"></div>
            </div>
        </div>

    
    <div id="mapa" aria-label="Mapa de Votação"></div>

    <!-- Selector de anos -->
<!-- Selector de anos -->
<!-- Selector de anos -->
<div class="year-selector" role="menu" aria-label="Selecionar Ano" style="text-align: center; display: flex; flex-direction: column; align-items: center;">

    <!-- Texto acima dos botões -->
    <div class="year-text" style="font-weight: bold; margin-bottom: 10px; font-size: 18px;">
        Eleições Municipais Pires Ferreira Ceará
    </div>
    <!-- Botões do menu -->
    <div class="year-options" style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
        <span class="year-option" style="padding: 10px 15px; cursor: pointer;" onclick="selecionarAno(this, '2000')">2000</span>
        <span class="year-option" style="padding: 10px 15px; cursor: pointer;" onclick="selecionarAno(this, '2004')">2004</span>
        <span class="year-option" style="padding: 10px 15px; cursor: pointer;" onclick="selecionarAno(this, '2008')">2008</span>
        <span class="year-option" style="padding: 10px 15px; cursor: pointer;" onclick="selecionarAno(this, '2012')">2012</span>
        <span class="year-option" style="padding: 10px 15px; cursor: pointer;" onclick="selecionarAno(this, '2016')">2016</span>
        <span class="year-option" style="padding: 10px 15px; cursor: pointer;" onclick="selecionarAno(this, '2020')">2020</span>
        <span class="year-option active" style="padding: 10px 15px; font-weight: bold;" onclick="selecionarAno(this, '2024')">2024</span>
    </div>
</div>
    <!-- Menu -->
    <div class="menu-container" role="menu" aria-label="Candidatos"></div>

    <footer>
        <p>&copy; 2024 Developed by Emanuel Valério Pereira. All rights reserved.</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const mapaUrl = "{% url 'atualizar_mapa' %}";
        const anoPadrao = '2024'; // Configuração padrão
    document.addEventListener('DOMContentLoaded', function() {
    // Botão ou ação que dispara a atualização do mapa
    const atualizarMapa = async () => {
        // Mostra o spinner de carregamento
        document.getElementById('loading').style.display = 'flex';

        try {
            // Envia a requisição AJAX para atualizar o mapa
            const response = await fetch('/atualizar-mapa', {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            });

            if (response.ok) {
                const data = await response.json();

                // Atualiza o mapa e outros elementos na página
                document.getElementById('map-container').innerHTML = data.mapa_html;
            } else {
                console.error('Erro ao carregar o mapa');
            }
        } catch (error) {
            console.error('Erro na requisição AJAX:', error);
        } finally {
            // Esconde o spinner após o carregamento
            document.getElementById('loading').style.display = 'none';
        }
    };

    // Adiciona o evento de clique no botão de atualização (caso exista)
    const botaoAtualizar = document.getElementById('btn-atualizar-mapa');
    if (botaoAtualizar) {
        botaoAtualizar.addEventListener('click', atualizarMapa);
    }
});

    function selecionarAno(element, ano) {
            // Atualiza o botão ativo
            document.querySelectorAll('.year-option').forEach(option => option.classList.remove('active'));
            element.classList.add('active');

            // Exibe o menu de candidatos
            const menuContainer = document.querySelector('.menu-container');
            menuContainer.style.display = 'flex';

            // Carrega o mapa do ano selecionado
            carregarMapa(ano);
        }

        function carregarMapa(ano) {
    // Exibe o spinner e barra de carregamento
    const loadingDiv = document.getElementById('loading');
    loadingDiv.style.display = 'flex';

    $.ajax({
        url: mapaUrl,
        data: { 'ano': ano },
        success: function(response) {
            if (response.mapa_html) {
                document.getElementById('mapa').innerHTML = response.mapa_html;
            } else {
                console.error("Erro ao carregar o mapa.");
            }

            if (response.candidatos) {
                atualizarCandidatos(response.candidatos);
            } else {
                console.error("Candidatos não encontrados.");
            }
        },
        error: function(xhr, status, error) {
            console.error("Erro na requisição AJAX:", error);
        },
        complete: function() {
            // Esconde o spinner e a barra após o carregamento
            setTimeout(() => {
                loadingDiv.style.display = 'none';
            }, 500); // Pequeno atraso para melhor efeito visual
        }
    });
}


    function atualizarCandidatos(candidatos) {
            const menuContainer = document.querySelector('.menu-container');
            menuContainer.innerHTML = ''; // Limpa o menu

            candidatos.forEach(candidato => {
                const div = document.createElement('div');
                div.classList.add('candidate');
                console.log(candidato.nome)
                div.onclick = () => selecionarCandidato(div, candidato.nome);

                const img = document.createElement('img');
                img.src = candidato.imagem_url;
                img.alt = candidato.nome;
                img.style.border = `5px solid ${candidato.cor}`;
                const p = document.createElement('p');
                p.textContent = candidato.nome;

                div.append(img, p);
                menuContainer.appendChild(div);
            });
        }

        function selecionarCandidato(element, candidato) {
            document.querySelectorAll('.candidate img').forEach(img => img.classList.remove('active'));
            element.querySelector('img').classList.add('active');

            const anoSelecionado = document.querySelector('.year-option.active').textContent.trim();
            $.ajax({
                url: mapaUrl,
                data: { 'ano': anoSelecionado, 'candidato': candidato },
                success: function(response) {
                    if (response.mapa_html) {
                        document.getElementById('mapa').innerHTML = response.mapa_html;
                    } else {
                        console.error("Erro ao atualizar o mapa.");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Erro na requisição AJAX:", error);
                }
            });
        }

        $(document).ready(() => carregarMapa(anoPadrao));
    </script>a
</body>
</html>